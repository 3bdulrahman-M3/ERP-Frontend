<app-layout pageTitle="ุงูุบุฑู ุงููุชุงุญุฉ">
  <div class="p-6 animate-fade-in">
    <!-- Header -->
    <div class="mb-6">
      <h2 class="text-4xl font-bold gradient-text">ุงูุบุฑู ุงููุชุงุญุฉ</h2>
      <p class="text-gray-600 mt-2">ุงูุบุฑู ุงูุชู ุชุทุงุจู ุชูุถููุงุชู</p>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="mb-4 p-4 bg-green-50 border border-green-200 rounded-xl animate-scale-in">
      <p class="text-sm text-green-600">{{ successMessage }}</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="mb-4 p-4 bg-red-50 border border-red-200 rounded-xl animate-scale-in">
      <p class="text-sm text-red-600">{{ errorMessage }}</p>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>

    <!-- Rooms Grid -->
    <div *ngIf="!isLoading && rooms.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
      <div
        *ngFor="let room of rooms"
        class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 hover:shadow-2xl transition-all duration-300"
      >
        <!-- Room Header -->
        <div class="flex justify-between items-start mb-4">
          <div>
            <h3 class="text-2xl font-bold text-gray-900 mb-1">ุบุฑูุฉ {{ room.roomNumber }}</h3>
            <p *ngIf="room.buildingInfo" class="text-sm text-gray-600">{{ room.buildingInfo.name }}</p>
            <p *ngIf="room.floor !== null" class="text-sm text-gray-600">ุงูุทุงุจู {{ room.floor }}</p>
          </div>
          <span
            [class]="'px-3 py-1 rounded-full text-xs font-semibold ' + getStatusBadgeClass(room.status)"
          >
            {{ getStatusText(room.status) }}
          </span>
        </div>

        <!-- Room Details -->
        <div class="space-y-2 mb-4">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ููุน ุงูุบุฑูุฉ:</span>
            <span class="text-sm font-semibold text-gray-900">{{ getRoomTypeText(room.roomType) }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ุนุฏุฏ ุงูุฃุณุฑูุฉ:</span>
            <span class="text-sm font-semibold text-gray-900">{{ room.totalBeds }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ุงูุฃุณุฑูุฉ ุงููุชุงุญุฉ:</span>
            <span class="text-sm font-semibold text-gray-900">{{ room.availableBeds }}</span>
          </div>
          <div *ngIf="room.roomType === 'single' && room.roomPrice" class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ุงูุณุนุฑ:</span>
            <span class="text-sm font-semibold text-green-600">{{ room.roomPrice }} ุฌููู</span>
          </div>
          <div *ngIf="room.roomType === 'shared' && room.bedPrice" class="flex justify-between items-center">
            <span class="text-sm text-gray-600">ุณุนุฑ ุงูุณุฑูุฑ:</span>
            <span class="text-sm font-semibold text-green-600">{{ room.bedPrice }} ุฌููู</span>
          </div>
        </div>

        <!-- Services -->
        <div *ngIf="room.services && room.services.length > 0" class="mb-4">
          <p class="text-sm text-gray-600 mb-2">ุงูุฎุฏูุงุช:</p>
          <div class="flex flex-wrap gap-2">
            <span
              *ngFor="let service of room.services"
              class="px-2 py-1 bg-blue-50 text-blue-700 rounded-lg text-xs font-semibold"
            >
              {{ service.name }}
            </span>
          </div>
        </div>

        <!-- Description -->
        <p *ngIf="room.description" class="text-sm text-gray-600 mb-4 line-clamp-2">{{ room.description }}</p>

        <!-- Request Button -->
        <button
          *ngIf="!room.hasPendingRequest && room.availableBeds > 0"
          (click)="openRequestModal(room)"
          class="w-full px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-cyan-700 transition-all duration-200"
        >
          ุชูุฏูู ุทูุจ
        </button>
        <div
          *ngIf="room.hasPendingRequest"
          class="w-full px-4 py-2 bg-yellow-100 text-yellow-700 rounded-xl font-semibold text-center"
        >
          ุทูุจ ููุฏ ุงูุงูุชุธุงุฑ
        </div>
        <div
          *ngIf="room.requestStatus === 'accepted'"
          class="w-full px-4 py-2 bg-green-100 text-green-700 rounded-xl font-semibold text-center"
        >
          ุชู ูุจูู ุงูุทูุจ
        </div>
        <div
          *ngIf="room.requestStatus === 'rejected'"
          class="w-full px-4 py-2 bg-red-100 text-red-700 rounded-xl font-semibold text-center"
        >
          ุชู ุฑูุถ ุงูุทูุจ
        </div>
        <div
          *ngIf="room.availableBeds === 0"
          class="w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-xl font-semibold text-center"
        >
          ูุง ุชูุฌุฏ ุฃุณุฑูุฉ ูุชุงุญุฉ
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && rooms.length === 0" class="text-center py-12">
      <div class="text-6xl mb-4">๐</div>
      <p class="text-xl text-gray-600 mb-2">ูุง ุชูุฌุฏ ุบุฑู ูุชุงุญุฉ</p>
      <p class="text-sm text-gray-500">ูุง ุชูุฌุฏ ุบุฑู ุชุทุงุจู ุชูุถููุงุชู ุญุงููุงู</p>
    </div>

    <!-- Pagination -->
    <div *ngIf="!isLoading && totalPages > 1" class="flex justify-center items-center gap-2 mt-6">
      <button
        (click)="loadRooms(currentPage - 1)"
        [disabled]="currentPage === 1"
        class="px-4 py-2 bg-white border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        ุงูุณุงุจู
      </button>
      <span class="px-4 py-2 text-gray-700">
        ุตูุญุฉ {{ currentPage }} ูู {{ totalPages }}
      </span>
      <button
        (click)="loadRooms(currentPage + 1)"
        [disabled]="currentPage === totalPages"
        class="px-4 py-2 bg-white border border-gray-300 rounded-lg font-semibold text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        ุงูุชุงูู
      </button>
    </div>

    <!-- Request Modal -->
    <div
      *ngIf="showRequestModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
      (click)="closeRequestModal()"
    >
      <div
        class="bg-white rounded-2xl p-6 max-w-md w-full mx-4"
        (click)="$event.stopPropagation()"
      >
        <h3 class="text-2xl font-bold text-gray-900 mb-4">ุชูุฏูู ุทูุจ ููุบุฑูุฉ</h3>
        <div *ngIf="selectedRoom" class="mb-4">
          <p class="text-sm text-gray-600 mb-2">ุงูุบุฑูุฉ: <span class="font-semibold">{{ selectedRoom.roomNumber }}</span></p>
          <p *ngIf="selectedRoom.buildingInfo" class="text-sm text-gray-600">ุงููุจูู: <span class="font-semibold">{{ selectedRoom.buildingInfo.name }}</span></p>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">ููุงุญุธุงุช (ุงุฎุชูุงุฑู)</label>
          <textarea
            [(ngModel)]="requestNotes"
            rows="4"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            placeholder="ุฃุถู ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ..."
          ></textarea>
        </div>
        <div class="flex gap-3">
          <button
            (click)="submitRequest()"
            [disabled]="isLoading"
            class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-cyan-700 transition-all duration-200 disabled:opacity-50"
          >
            {{ isLoading ? 'ุฌุงุฑู ุงูุฅุฑุณุงู...' : 'ุชูุฏูู ุงูุทูุจ' }}
          </button>
          <button
            (click)="closeRequestModal()"
            [disabled]="isLoading"
            class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-all duration-200 disabled:opacity-50"
          >
            ุฅูุบุงุก
          </button>
        </div>
      </div>
    </div>
  </div>
</app-layout>

