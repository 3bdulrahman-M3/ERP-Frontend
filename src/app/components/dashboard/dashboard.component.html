<app-layout pageTitle="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…">
<div *ngIf="currentRoute === '/dashboard'" class="p-4">
  <div class="space-y-4">
    <!-- Welcome Header -->
    <div class="relative overflow-hidden bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 rounded-2xl shadow-xl p-6 text-white">
      <div class="relative z-10">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <div>
            <h1 class="text-3xl font-bold mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ currentUser?.name }} ğŸ‘‹</h1>
            <p class="text-white/90 text-sm">
              {{ currentUser?.role === 'admin' ? 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±' : 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ø§Ù„Ø¨' }}
            </p>
          </div>
          <div class="flex items-center gap-3">
            <div class="bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2">
              <span [class]="currentUser?.role === 'admin' ? 'text-yellow-300' : 'text-cyan-300'" class="text-lg font-bold">
                {{ currentUser?.role === 'admin' ? 'ğŸ‘‘' : 'ğŸ“' }}
              </span>
              <span class="mr-2 font-semibold">{{ currentUser?.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ø·Ø§Ù„Ø¨' }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
      <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full blur-2xl"></div>
    </div>
    
    <!-- User Info - Compact -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <div class="bg-white rounded-xl shadow-md p-4 border border-gray-100">
        <p class="text-xs text-gray-500 mb-1">Ø§Ù„Ø§Ø³Ù…</p>
        <p class="text-base font-semibold text-gray-800">{{ currentUser?.name }}</p>
      </div>
      <div class="bg-white rounded-xl shadow-md p-4 border border-gray-100">
        <p class="text-xs text-gray-500 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
        <p class="text-sm font-semibold text-gray-800 truncate">{{ currentUser?.email }}</p>
      </div>
      <div class="bg-white rounded-xl shadow-md p-4 border border-gray-100">
        <p class="text-xs text-gray-500 mb-1">Ø§Ù„Ø­Ø§Ù„Ø©</p>
        <span [class]="currentUser?.isActive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'" 
              class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold">
          <span class="w-1.5 h-1.5 rounded-full mr-1.5" [class.bg-green-500]="currentUser?.isActive" [class.bg-red-500]="!currentUser?.isActive"></span>
          {{ currentUser?.isActive ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·' }}
        </span>
      </div>
    </div>

    <!-- Quick Stats - Admin Only -->
    <div *ngIf="currentUser?.role === 'admin'" class="grid grid-cols-2 lg:grid-cols-4 gap-3">
      <!-- Total Students -->
      <div class="bg-white rounded-xl shadow-md p-4 border-l-4 border-blue-500 hover:shadow-lg transition-shadow">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs text-gray-500 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
            <p class="text-2xl font-bold text-gray-800">
              <span *ngIf="!isLoadingStats">{{ totalStudents }}</span>
              <span *ngIf="isLoadingStats" class="inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></span>
            </p>
          </div>
          <div class="text-3xl">ğŸ“</div>
        </div>
      </div>

      <!-- Total Rooms -->
      <div class="bg-white rounded-xl shadow-md p-4 border-l-4 border-cyan-500 hover:shadow-lg transition-shadow">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs text-gray-500 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ù</p>
            <p class="text-2xl font-bold text-gray-800">
              <span *ngIf="!isLoadingStats">{{ totalRooms }}</span>
              <span *ngIf="isLoadingStats" class="inline-block w-6 h-6 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"></span>
            </p>
          </div>
          <div class="text-3xl">ğŸ </div>
        </div>
      </div>

      <!-- Available Rooms -->
      <div class="bg-white rounded-xl shadow-md p-4 border-l-4 border-green-500 hover:shadow-lg transition-shadow">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs text-gray-500 mb-1">Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
            <p class="text-2xl font-bold text-gray-800">
              <span *ngIf="!isLoadingStats">{{ availableRooms }}</span>
              <span *ngIf="isLoadingStats" class="inline-block w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full animate-spin"></span>
            </p>
          </div>
          <div class="text-3xl">âœ…</div>
        </div>
      </div>

      <!-- Occupied Rooms -->
      <div class="bg-white rounded-xl shadow-md p-4 border-l-4 border-purple-500 hover:shadow-lg transition-shadow">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs text-gray-500 mb-1">Ø§Ù„ØºØ±Ù Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©</p>
            <p class="text-2xl font-bold text-gray-800">
              <span *ngIf="!isLoadingStats">{{ occupiedRooms }}</span>
              <span *ngIf="isLoadingStats" class="inline-block w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"></span>
            </p>
          </div>
          <div class="text-3xl">ğŸ›ï¸</div>
        </div>
      </div>
    </div>

    <!-- Student Info Cards -->
    <div *ngIf="currentUser?.role === 'student'" class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <!-- Check-in/out Status -->
      <div class="bg-white rounded-xl shadow-md p-4 border border-gray-100">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="bg-green-100 rounded-lg p-3">
              <span class="text-2xl">ğŸ </span>
            </div>
            <div>
              <p class="text-xs text-gray-500 mb-1">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„Ø®Ø±ÙˆØ¬</p>
              <p *ngIf="isLoadingStatus" class="text-sm font-semibold text-gray-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
              <div *ngIf="!isLoadingStatus" class="flex items-center gap-2">
                <span [class]="checkInOutStatus?.isCheckedIn ? 'w-2 h-2 bg-green-500 rounded-full' : 'w-2 h-2 bg-red-500 rounded-full'"></span>
                <span class="text-base font-bold text-gray-800">
                  {{ checkInOutStatus?.isCheckedIn ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙƒÙ†' : 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø³ÙƒÙ†' }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="checkInOutStatus && checkInOutStatus.checkInTime" class="mt-3 pt-3 border-t border-gray-100">
          <p class="text-xs text-gray-500 mb-1">Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„</p>
          <p class="text-sm font-semibold text-gray-700">{{ formatDateTime(checkInOutStatus.checkInTime) }}</p>
        </div>
      </div>

      <!-- Kitchen Status -->
      <div class="bg-white rounded-xl shadow-md p-4 border border-gray-100">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <div class="bg-orange-100 rounded-lg p-3">
              <span class="text-2xl">ğŸ½ï¸</span>
            </div>
            <div>
              <p class="text-xs text-gray-500 mb-1">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ø¨Ø®</p>
              <span *ngIf="isLoadingKitchen" class="text-sm font-semibold text-gray-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
              <span *ngIf="!isLoadingKitchen && kitchenStatus?.isOpen" 
                    class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">
                <span class="w-1.5 h-1.5 bg-green-500 rounded-full mr-1.5"></span>
                Ù…ÙØªÙˆØ­
              </span>
              <span *ngIf="!isLoadingKitchen && !kitchenStatus?.isOpen" 
                    class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700">
                <span class="w-1.5 h-1.5 bg-red-500 rounded-full mr-1.5"></span>
                Ù…ØºÙ„Ù‚
              </span>
            </div>
          </div>
        </div>
        
        <!-- Current Meal Info -->
        <ng-container *ngIf="!isLoadingKitchen && kitchenStatus?.isOpen && kitchenStatus?.currentMeal as currentMeal">
          <div class="mb-3 p-3 bg-green-50 rounded-lg border border-green-200">
            <p class="text-xs text-gray-600 mb-1">Ø§Ù„ÙˆØ¬Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
            <p class="text-sm font-bold text-gray-900 mb-1">
              {{ mealNames[currentMeal.name] || currentMeal.name }}
            </p>
            <p class="text-xs text-gray-600">
              Ù…Ù† {{ formatTime12Hour(currentMeal.startTime) }} Ø¥Ù„Ù‰ {{ formatTime12Hour(currentMeal.endTime) }}
            </p>
          </div>
        </ng-container>
        <div class="grid grid-cols-2 gap-2">
          <!-- Countdown Timer -->
          <div *ngIf="currentUser?.role === 'student' && (countdownTimer || isLoadingKitchen)" class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-2.5 text-white">
            <p class="text-xs font-semibold mb-1.5 text-center">
              <span *ngIf="kitchenStatus?.isOpen">Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø·Ø¨Ø®</span>
              <span *ngIf="!kitchenStatus?.isOpen">Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„ÙˆØ¬Ø¨Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>
            </p>
            <div *ngIf="isLoadingKitchen" class="text-center py-2">
              <p class="text-xs opacity-90">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
            <div *ngIf="!isLoadingKitchen && countdownTimer" class="flex items-center justify-center gap-1.5" style="direction: ltr;">
              <div class="text-center">
                <p class="text-base font-bold">{{ padNumber(countdownTimer.hours) }}</p>
                <p class="text-xs opacity-90">Ø³Ø§Ø¹Ø©</p>
              </div>
              <span class="text-base font-bold">:</span>
              <div class="text-center">
                <p class="text-base font-bold">{{ padNumber(countdownTimer.minutes) }}</p>
                <p class="text-xs opacity-90">Ø¯Ù‚ÙŠÙ‚Ø©</p>
              </div>
              <span class="text-base font-bold">:</span>
              <div class="text-center">
                <p class="text-base font-bold">{{ padNumber(countdownTimer.seconds) }}</p>
                <p class="text-xs opacity-90">Ø«Ø§Ù†ÙŠØ©</p>
              </div>
            </div>
            <div *ngIf="!isLoadingKitchen && !countdownTimer" class="text-center py-2">
              <p class="text-xs opacity-90">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¬Ø¨Ø© Ù‚Ø§Ø¯Ù…Ø©</p>
            </div>
          </div>
          <div *ngIf="nextMealTime" class="bg-gray-50 rounded-lg p-2">
            <p class="text-xs text-gray-500 mb-1">
              <span *ngIf="kitchenStatus?.isOpen">ÙˆÙ‚Øª Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø·Ø¨Ø®</span>
              <ng-container *ngIf="!kitchenStatus?.isOpen && kitchenStatus?.nextMeal as nextMeal">
                <span>Ù…Ø¹Ø§Ø¯ {{ mealNames[nextMeal.name] }}</span>
              </ng-container>
            </p>
            <p class="text-sm font-bold text-gray-800">{{ nextMealTime }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chat Widget for Students -->
<app-chat-widget *ngIf="currentUser?.role === 'student'"></app-chat-widget>
</app-layout>

